# Medical Records MongoDB Database System

## üìã Overview

A comprehensive synthetic medical records database system designed for teaching NoSQL concepts using MongoDB. This system generates realistic but completely fictional patient data, medical visits, and laboratory results, making it perfect for educational purposes while ensuring full compliance with HIPAA/GDPR privacy regulations.

**Author**: Diogo Ribeiro  
**Institution**: ESMAD - Instituto Polit√©cnico do Porto  
**Course**: NoSQL Databases  
**License**: MIT  

## ‚ö†Ô∏è Important Notice

**ALL DATA GENERATED BY THIS SYSTEM IS 100% SYNTHETIC AND FICTIONAL**

- No real patient information is used or stored
- All names, addresses, and medical information are artificially generated
- Safe for educational and demonstration purposes
- Compliant with HIPAA, GDPR, and Portuguese data protection laws

## üéØ Educational Objectives

This database system teaches:

1. **Document-Oriented Design** - Patient-centric data model
2. **Temporal Data Management** - Medical history over time
3. **Complex Aggregations** - Healthcare analytics and reporting
4. **Data Privacy** - Working with synthetic data generation
5. **Portuguese Healthcare Context** - SNS numbers, local cities, regional patterns
6. **Real-World Patterns** - Emergency visits, chronic disease management, lab results

## üöÄ Quick Start

### Prerequisites

```bash
# Python 3.7+ required
pip install faker pandas pymongo
```

### Generate Synthetic Data

```bash
# Generate default dataset (1000 patients)
python generate_medical_database.py

# Generate larger dataset
python generate_medical_database.py --patients 5000
```

### Import to MongoDB

```bash
# Option 1: Automatic import with analytics
python medical_mongodb_analytics.py --import

# Option 2: Manual import
mongoimport --db medical --collection patients --file medical_database/patients.json --jsonArray
mongoimport --db medical --collection visits --file medical_database/visits.json --jsonArray
mongoimport --db medical --collection lab_results --file medical_database/lab_results.json --jsonArray
```

### Run Analytics

```bash
# Run all analytics queries
python medical_mongodb_analytics.py

# Import and analyze
python medical_mongodb_analytics.py --import --data-dir ./medical_database
```

## üìä Database Schema

### Collections Structure

#### 1. **patients** Collection
```javascript
{
  patient_id: "PT000001",
  health_number: "SNS123456789",  // Portuguese SNS or generic ID
  demographics: {
    first_name: "Jo√£o",
    last_name: "Silva",
    full_name: "Jo√£o Silva",
    date_of_birth: "1980-05-15",
    age: 44,
    gender: "M",
    blood_type: "A+"
  },
  contact: {
    address: {
      street: "Rua do Hospital, 123",
      city: "Porto",
      postal_code: "4000-123",
      country: "Portugal"
    },
    phone: "+351 912345678",
    email: "joao.silva@email.com",
    emergency_contact: {
      name: "Maria Silva",
      relationship: "Spouse",
      phone: "+351 913456789"
    }
  },
  medical_history: {
    chronic_conditions: ["Hypertension", "Type 2 Diabetes"],
    allergies: ["Penicillin"],
    current_medications: [
      {
        name: "Metformin",
        dosage: "500mg",
        frequency: "Twice daily",
        condition: "Type 2 Diabetes"
      }
    ],
    family_history: [...],
    surgical_history: [...],
    immunizations: [...]
  },
  insurance: {
    provider: "SNS",
    policy_number: "POL123456",
    group_number: "GRP1234"
  },
  primary_care_physician: {
    name: "Dr. Ana Santos",
    specialty: "Internal Medicine",
    phone: "+351 221234567"
  }
}
```

#### 2. **visits** Collection
```javascript
{
  visit_id: "V000001_0001",
  patient_id: "PT000001",
  visit_date: "2024-11-15T10:30:00",
  type: "Routine checkup",
  department: "Internal Medicine",
  provider: {
    name: "Dr. Carlos Ferreira",
    specialty: "General Practice"
  },
  chief_complaint: "Annual physical exam",
  symptoms: ["None"],
  vital_signs: {
    blood_pressure: {
      systolic: 120,
      diastolic: 80,
      unit: "mmHg"
    },
    heart_rate: 72,
    temperature: 36.5,
    weight: 75.5,
    height: 175,
    bmi: 24.7
  },
  diagnosis: [
    {
      code: "Z00.00",
      name: "Encounter for general adult medical exam"
    }
  ],
  procedures: [...],
  prescriptions: [...],
  lab_orders: [...],
  follow_up: {
    required: true,
    timeframe: "6 months",
    notes: "Regular diabetes monitoring"
  }
}
```

#### 3. **lab_results** Collection
```javascript
{
  result_id: "LAB000001_0001",
  patient_id: "PT000001",
  test_date: "2024-11-15",
  test_code: "GLU",
  test_name: "Blood Glucose",
  value: "95",
  unit: "mg/dL",
  normal_range: "70-100",
  abnormal_flag: "N",  // N=Normal, H=High, L=Low
  status: "Final",
  ordering_provider: "Dr. Carlos Ferreira",
  lab_facility: "Porto Medical Lab",
  notes: "Results reviewed and verified"
}
```

## üîç MongoDB Queries Examples

### Basic Queries

```javascript
// Find all patients from Porto
db.patients.find({"contact.address.city": "Porto"})

// Find patients with diabetes
db.patients.find({"medical_history.chronic_conditions": "Type 2 Diabetes"})

// Recent emergency visits
db.visits.find({
  "department": "Emergency",
  "visit_date": {$gte: ISODate("2024-01-01")}
})

// Abnormal lab results
db.lab_results.find({"abnormal_flag": "H"})
```

### Advanced Aggregations

```javascript
// Patient 360¬∞ View
db.patients.aggregate([
  {$match: {"patient_id": "PT000001"}},
  {$lookup: {
    from: "visits",
    localField: "patient_id",
    foreignField: "patient_id",
    as: "recent_visits"
  }},
  {$lookup: {
    from: "lab_results",
    localField: "patient_id",
    foreignField: "patient_id",
    as: "lab_history"
  }}
])

// Department workload analysis
db.visits.aggregate([
  {$group: {
    _id: "$department",
    total_visits: {$sum: 1},
    unique_patients: {$addToSet: "$patient_id"}
  }},
  {$project: {
    department: "$_id",
    total_visits: 1,
    patient_count: {$size: "$unique_patients"}
  }},
  {$sort: {total_visits: -1}}
])

// High-risk patients (elderly with multiple conditions)
db.patients.find({
  $and: [
    {"demographics.age": {$gte: 65}},
    {$expr: {$gte: [{$size: "$medical_history.chronic_conditions"}, 3]}}
  ]
})
```

## üìà Analytics Features

The `medical_mongodb_analytics.py` script provides:

1. **High-Risk Patient Identification** - Find elderly patients with multiple chronic conditions
2. **Department Load Analysis** - Analyze visit patterns by department
3. **Follow-up Alerts** - Identify patients with abnormal lab results
4. **Medication Usage Statistics** - Most prescribed medications analysis
5. **Chronic Disease Prevalence** - Statistical analysis of conditions
6. **Emergency Department Trends** - Monthly ED visit patterns
7. **Patient 360¬∞ View** - Complete patient profile with history

## üè• Data Characteristics

### Demographics

- **70% Portuguese patients** with Portuguese names and SNS numbers
- **30% International patients** with diverse backgrounds
- Age range: 1-95 years
- Realistic age-based condition distribution

### Medical Data

- **8 blood types** (A+, A-, B+, B-, AB+, AB-, O+, O-)
- **15+ chronic conditions** (Hypertension, Diabetes, Asthma, etc.)
- **20+ medications** with proper dosages and frequencies
- **10+ lab test types** with realistic value ranges
- **10 departments** (Emergency, Cardiology, Pediatrics, etc.)

### Portuguese Context

- Cities: Porto, Lisboa, Braga, Coimbra, Aveiro, Faro, Viseu
- Portuguese phone format: +351 9XXXXXXXX
- Portuguese postal codes: XXXX-XXX
- SNS (Servi√ßo Nacional de Sa√∫de) numbers
- Local insurance providers: SNS, M√©dis, Multicare, AdvanceCare

## üìÅ File Structure

```
medical_database/
‚îú‚îÄ‚îÄ patients.json          # Patient records (1000+ documents)
‚îú‚îÄ‚îÄ visits.json            # Medical visits (5000+ documents)
‚îú‚îÄ‚îÄ lab_results.json       # Lab test results (3000+ documents)
‚îî‚îÄ‚îÄ mongodb_schema.js      # MongoDB schema and index definitions

Scripts/
‚îú‚îÄ‚îÄ generate_medical_database.py  # Data generator
‚îú‚îÄ‚îÄ medical_mongodb_analytics.py  # Analytics and queries
‚îî‚îÄ‚îÄ README.md                      # This file
```

## üéì Teaching Applications

### Week 1: Document Design
- Patient-centric model vs traditional relational design
- Embedding vs referencing decisions
- Schema design for healthcare

### Week 2: Indexing Strategies
- Single field indexes (patient_id, health_number)
- Compound indexes (patient_id + visit_date)
- Text indexes for patient search
- Array field indexes (chronic_conditions)

### Week 3: Aggregation Framework
- $lookup for joining collections
- $group for statistical analysis
- $project for data transformation
- Pipeline optimization

### Week 4: Time-Series Data
- Medical history over time
- Lab result trends
- Visit patterns analysis

### Week 5: Analytics & Reporting
- Dashboard queries
- Risk assessment algorithms
- Population health metrics

## üõ°Ô∏è Privacy & Compliance

This system ensures privacy through:

1. **Synthetic Data Generation** - Using Faker library for realistic but fake data
2. **No Real Patient Information** - All medical records are artificially generated
3. **Educational Purpose Only** - Clearly marked as training data
4. **Compliance** - Meets HIPAA, GDPR, and Portuguese data protection requirements

## üêõ Troubleshooting

### Common Issues

**Import Error: No module named 'faker'**
```bash
pip install faker
```

**MongoDB Connection Error**
```bash
# Ensure MongoDB is running
sudo systemctl start mongod
# Or on Windows:
net start MongoDB
```

**Insufficient Memory for Large Datasets**
```bash
# Generate smaller dataset
python generate_medical_database.py --patients 500
```

## üìä Performance Considerations

- Default dataset (1000 patients): ~5MB total
- Large dataset (5000 patients): ~25MB total
- Indexes add ~20% storage overhead
- Query performance: <10ms for indexed queries
- Aggregation performance: <100ms for most pipelines

## ü§ù Contributing

Contributions are welcome! Please ensure:

1. All data remains synthetic
2. No real patient information is included
3. Code follows PEP 8 standards
4. Documentation is updated

## üîó Related Resources

- [MongoDB University](https://university.mongodb.com/)
- [MongoDB Documentation](https://docs.mongodb.com/)
- [HIPAA Compliance Guide](https://www.hhs.gov/hipaa/index.html)
- [GDPR Guidelines](https://gdpr.eu/)
- [Portuguese SNS Information](https://www.sns.gov.pt/)

---

**Note**: This is an educational project. For production healthcare systems, always consult with legal and compliance experts to ensure proper data handling and security measures.
